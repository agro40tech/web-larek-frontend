# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Об архитектуре

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях. Данна архитектура носит название MVP.

## Базовый код

### Класс `Model`

Данный класс является базовым и небходим для наследования и использования общих методов, так же он поможет отличить модель от простых объектов с данными.

#### Поля

Не имеет полей.

#### Конструктор

В конструкторе получает класс `events`, данный класс нужен для для метода `emitChanges`.

#### Методы

`emitChanges`: В качестве параметров получает `event` который содержит название события и `payload` это объект котороый нужно передать в событии.

### Класс `Component`

Данный класс является базовым и небходим для наследования и использования общих методов для работы с `DOM-элементами`. Он поможет классам представителям использовать общий функционал.

#### Поля

Не имеет полей.

#### Конструктор

Не имеет конструктора.

#### Методы

- `toggleClass`: Принимает в качестве параметров `element`, `className`, `force`. После получения параметров у данного элемента переключается класс с помощью `toggle`, в качестве названия класса служит `className`. `force` служит для точного сообщения о том нужно ли удалить класс или добавить.

- `setText`: Принимает в качестве параметов `element` и `value`. После получения параметров у данного элемента устанавилвается `textContent` равное значению `value`.

- `setDisabled`: Получает в качестве параметров `element` и `state`. После получения параметров у данного элемента в зависимости от булевого значения `state` добавляется или удаляется атрибут `disabled`.

- `setHidden`: В качестве параметра принимает `element` после чего у этого `element` устанавиливает стиль `display: none`.

- `setVisible`: В качестве параметра принимает `element` после чего у этого `element` удаляет стиль `display`.

- `setImage`: Принимает в качестве параметров `element`, `src` и `alt`. После получения параметров у данного `element` устанавливается атримут `src` равное значению `src` полученного в параметрах. Так же устанавливается атрибут `alt`.

### Класс `Api`

Данный класс является базовым и небходим для наследования и использования общих методов для работы с `api`.

#### Поля

- `baseUrl`: Содержит в себе базовую ссылку к `api`.

- `options`: Содержит в себе объект с настройками запроса.

#### Конструктор

В конструкторе получает параметры `baseUrl` который является базовой ссылкой `api` и `options` для установки настроек запроса.

#### Методы

- `handleResponse`: Получает в параметрах `response` в случае если статус `response` является `ok` возвращает `json()` этого `response`, иначе возвращает ошибку.

- `get`: Получает в параметрах `uri` и делает `get` запрос в качестве `url` использутеся комбинация из `baseUrl` и `uri`.

- `post`: Получает в параметрах `uri`, `data` и `method`. Делает `post` запрос запрос в качестве `url` использутеся комбинация из `baseUrl` и `uri`. Так же есть возможность передать в настройках метод запроса из парметров, по дефолту будет `post`.

### Класс `EventEmitter`

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы `on` , `off` , `emit` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод `trigger` , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса `EventEmitter` .

## Компоненты модели данных (бизнес-логика)

### Класс `CatalogModel`

Данный класс является моделью и небходим для работы с данными каталога продуктов. Наследует класс `Model`.

#### Поля

- `items`: Содержит коллекцию объектов продукта:

```
export type TProduct = {
    id: string;
    category: string;
    name: string;
    image: string;
    price: number;
    description: string;
};
```

#### Конструктор

В конструкторе получает класс `events`, данный класс нужен для вызова события `init` который сообщает о том, что состояние коллекции класса `CatalogModel` было изменено.

#### Методы

- `setItems`: Принимает в качестве параметра массив продуктов, проходит по массиву и добавляет продукты в поле `items`. В конце метод вызывает оповещение об изменении состояния.

- `getItem`: Принимает в качестве параметра `id` продукта и в случае успешного поиска в поле `items` возвращает продукт.

### Класс `BusketModel`

Данный класс является моделью и небходим для работы с данными корзины продуктов. Наследует класс `Model`. Он может преведенными ниже методами работать с коллекцией продуктов, удалять, добавлять, отчищать, отдавать `id` продуктов, отдавать общую стоимость и пребавлять её.

#### Поля

- `items`: Содержит коллекцию ключа и значения, в роле ключа выступает `id` продукта, а в роли значения кол-во продукта добавленного в корзину.

- `totalPrice`: Содержит общую сумму товаров корзины.

#### Конструктор

В конструкторе получает класс `events`, данный класс нужен для метода `change` который сообщает о том, что состояние коллекции класса `BusketModel` было изменено.

#### Методы

- `addItem`: Принимает в качестве параметра `id` и добавляет новую запись в коллекцию с `id` продукта и начальным кол-вом `0` в случае если продукт с таким `id` уже добавлен то прибавляет кол-во продукта на `1`.

- `removeItem`: Принимает в качестве параметра `id` продукта которое нужно удалить из коллекции, в случае успешного поиска уменьшает кол-во продукта на `1`, если кол-во становится равно `0` то удаляет элемент из коллекции.

- `clearTotalPrice`: Приравнивает поле `totalPrice` к 0. Необходим для отчистки общей стоимости товаров в корзине.

- `clear`: Отчищает поле `items` и вызывает методы `change` и `clearTotalPrice`.

- `incrementTotalPrice`: Принимает в качестве параметра общую стоимость товара и прибавляет её к полю `totalPrice`.

- `getTotalPrice`: Возвращает поле `totalPrice`.

- `getIds`: Возвращает массив состоящий из `id` товаров которые были в корзине, в случае если кол-во товара больше 1 то он копирует `id` товара столько раз сколько раз он был добавлен в корзину.

- `change`: Регистрирует событие изменения с помощью `events`, данное событие влечет за собой сборку представлений item-ов карточки корзины и рендера корзины.

### Класс `UserDataModel`

Данный класс является моделью и небходим для работы с данными пользователя. Наследует класс `Model`. Он постепенно собирает данные а потом может их отдать одним объектом.

#### Поля

- `address`: Содержит в себе адрес пользователя.

- `email`: Содержит в себе почту пользователя.

- `paymentMethod`: Содержит в себе метод оплаты который выбрал пользователь.

- `phoneNumber`: Содержит в себе номер телефона пользователя.

#### Конструктор

Не имеет конструктора, так как использует потерн build, все значения по этапное устанавливаются с помощью методов класса.

#### Методы

- `setPayment`: Принимает в качестве параметра метод оплаты и устанавливает это значение в поле `paymentMethod`. Возвращает контекст `this`.

- `setAddress`: Принимает в качестве параметра адрес пользователя и устанавливает это значение в поле `address`. Возвращает контекст `this`.

- `setEmail`: Принимает в качестве параметра почту пользователя и устанавливает это значение в поле `email`. Возвращает контекст `this`.

- `setPhoneNumber`: Принимает в качестве параметра номер телефона пользователя и устанавливает это значение в поле `phoneNumber`. Возвращает контекст `this`.

- `getUserData`: Возвращает объект с данными пользователя:

```
return {
            address: this._address,
            email: this._email,
            paymentMethod: this._paymentMethod,
            phoneNumber: this._phoneNumber,
        };
```

## Компоненты представления

Все поля в классах представления с пометкой `ui` в названии являются компонентами `html` которые были найдены или переданы в конструкторе. Так же все компоненты либо на прямую наследуют интерфейс `IView` либо через свой личный интерфейс. `IView` описывает метод `render` который обязывает принять данный в виде `data: object` и вернуть `HTMLElement`:

```
export interface IView {
    render: (data: object) => HTMLElement;
}

```

### Класс `BasketItemView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с пунктами продуктов корзины, а именно устанавливает значения в нужные поля `ui` и устанавливает обработички событий. Наследует класс `Component`.

#### Поля

- `uiTotalPrice`: Предназначен для отображения общей стоимости товара.

- `uiTotalCount`: Предназначен для отображения кол-во товара в корзине.

- `uiTitle`: Предназначен для отображения названия товара.

- `uiRemoveButton`: Предназначен для удаления товара из корзины.

- `id`: Содержит в себе `id` последнего товара который был собран через данный класс, необходим для кеширования контейнера который возвращается в методе `render`.

#### Конструктор

В конструкторе получает класс `events` для оповещения удаления товара из корзины и `container` для операций с темплейтом карточки товара в корзине.

#### Методы

`render`: В качестве параметров принимает:

```
data: {
        product: TProduct;
        totalCount: number;
        totalPrice: number;
    }
```

В случае если `id` продукта совпадает с полем `id` то просто возвращает `container`, иначе производит манипуляции с `ui` полями, а именно подставляет значения полученные в параметрах в содержимое `ui` компонентов.

### Класс `BasketView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с корзиной, а именно делать предварительный `render` и отдавать `container`. Наследует класс `Component`.

#### Поля

- `uiTotalPrice`: Предназначен для отображения общей стоимости товаров в корзине.

- `uiOrderButton`: Предназначен для перемещения к модальному окну оформления заказа.

- `uiChildContainer`: Предназначен для монтирования собранного списка `HTMLElement`-ов полученных с помощью класса `BasketItemView`.

#### Конструктор

В конструкторе получает класс `events` для оповещения перехода к оформлению заказа и `container` для операций с темплейтом корзины товаров.

#### Методы

- `getContainer`: Возвращает `container` который был собран с помощью метода `render` необходим для быстрого получения актуального контейнера корзины т. к. контейнер постоянно пере собирается из-за изменений модели.

- `render`: В качестве параметов принимает объект `data` представленный ниже, монтирует в поле `uiChildContainer` и возвращает `container`.

```
data: { items: HTMLElement[]; totalPrice: number }

```

### Класс `CatalogItemView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с пунктами продуктов каталога, а именно устанавливает значения в нужные поля `ui` и устанавливает обработички событий. Наследует класс `Component`.

#### Поля

- `uiPrice`: Предназначен для отображения стоимости товаров.

- `uiName`: Предназначен для отображения названия товара.

- `uiImage`: Предназначен для работы с изображением карточка товара.

- `uiCategory`: Предназначен для отображения категории товара.

- `dataProduct`: Предназначен для хранения данных о товаре и передаче их в событие, которое инициализируется при нажатии на саму карточку.

#### Конструктор

В конструкторе получает класс `events` для оповещения перехода к превью товара и `container` для операций с темплейтом карточки каталога. На сам контейнер так как он является карточкой, а соответственно кнопкой навешивается слушатель событий, который генерирует ивент открытия превью карточка при клике и предаёт данные карточки в этот ивент.

#### Методы

`render`: Принимает в качестве параметра `data: TProduct`, устанавливает данные о продукте в поля `ui`, в случае если цена продукта равна `null` то в поле с ценой записывается строка `бесценно`.

### Класс `CatalogView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с каталогом, а именно добавлять заранее созданный массив `HTML` элементов которые получает в методе `render` в `container`. Наследует класс `Component`.

#### Поля

Не имеет полей.

#### Конструктор

В конструкторе получает `container` для операций с контейнером каталога карточек.

#### Методы

`render`: В качестве параметра принимает `items: HTMLElement[]` которые потом добавляет в контейнер полученный в конструкторе.

### Класс `ProductView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с модальным окном товара, а именно устанавливает значения в нужные поля `ui` и устанавливает обработички событий. Наследует класс `Component`.

#### Поля

- `uiCategory`: Предназначен для отображения категории товара.

- `uiDescription`: Предназначен для отображения описания товара.

- `uiImage`: Предназначен для работы с изображением карточки товара.

- `uiName`: Предназначен для отображения названия товара.

- `uiPrice`: Предназначен для отображения стоимости товара.

- `uiAddToBasketButton`: Предназначен для установки слушателя на кнопку добавления товара в корзину

#### Конструктор

В конструкторе получает класс `events` для оповещения добавления товара в корзину и `container` для операций с темплейтом превью карточки.

#### Методы

`render`: Принимает в качестве параметров `data: TProduct` устанавливает инофрмацию о товаре в нужные `ui` элементы, в случае если цена продукта равна `null` то в поле с ценой записывается строка `бесценно`. Так же кеширует `id` товара и в случае, если прошлый товар имел такой `id`, то возвращает `container`.

### Класс `OrderFormView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с формой заказа `order`, а именно валидирует информацию, устанавливает необходимые слушатели и отдает готовую форму. Наследует класс `Form`.

#### Поля

- `uiOrderButton`: Предназначен для навешивания слушателя клика, который будет вызывать события подтвержения что форма заполнена, закрытия модального окна и открытия модального окна с формой контактов.

- `uiPaymentButtons`: Предназначен для навешивания слушателей, которые будут менять выбранный метод оплаты, который сохраняется в поле `paymentMethod`.

- `uiFormInput`: Предназначен для навешивания слушателя который будет вызывать валидацию поля `address` и заполнять это поле вводимыми данными.

- `address`: Содержит в себе данные которые ввел пользователь в поле `uiFormInput`.

- `paymentMethod`: Содержит в себе данные выбранного пользователем метода оплаты.

#### Конструктор

В конструкторе получает класс `events` для оповещений что форма успешно заполнена, необходимо закрыть модальное окно и открыть модальное окно с контактами. Так же получает параметр `container` для операций с темплейтом формы оформления заказа.

#### Методы

- `render`: Возвращает `container`.

### Класс `ContactsFormView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать с формой контактов `contacts`, а именно валидирует информацию, устанавливает необходимые слушатели и отдает готовую форму. Наследует класс `Form`.

#### Поля

- `uiContactsButton`: Предназначен для навешивания слушателя клика, который будет вызывать события подтверждения что форма заполнена, закрытия модального окна и открытия модального окна с сообщением об успешном заказе.

- `uiEmailInput`: Предназначен для навешивания слушателя, который будет вызывать валидацию поля `email` и заполнять это поле вводимыми данными.

- `uiPhoneNumberInput`: Предназначен для навешивания слушателя, который будет вызывать валидацию поля `phoneNumber` и заполнять это поле вводимыми данными.

- `email`: Содержит в себе данные которые ввел пользователь в поле `uiEmailInput`.

- `phoneNumber`: Содержит в себе данные которые ввел пользователь в поле `uiPhoneNumberInput`.

#### Конструктор

В конструкторе получает класс `events` для оповещений что форма успешно заполнена, необходимо закрыть модальное окно и открыть модальное окно с сообщением об успешном заказе. Ивент об открытии окно, которое сообщает об успешном заказе отправляет данные с помощью `api`. Так же получает параметр `container` для операций с темплейтом формы контактов пользователя.

#### Методы

- `render`: Возвращает `container`.

### Класс `SuccessView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать модальным окном оповещения об успешном заказе, а именно устанавливает сумму заказа в соответствующее поле и добавляет слушатель события на кнопку `за новыми покупакми`. Наследует класс `Component`.

#### Поля

- `uiSuccessButton`: Предназначен для навешивания слушателя событий клика которое создает событие закрытия модального окна.

- `uiSuccessDescription`: Предназначен для отображения суммы заказа.

#### Конструктор

В конструкторе получает класс `events` для оповещения о закрытии модального окна. Так же получает параметр `container` для операций с темплейтом модального окна с сообщением об успешном заказе.

#### Методы

`render`: Получает в качестве параметра объект `data: { totalPrice: number }`, устанавливает значение в поле `uiSuccessDescription`и возвращает `container`.

### Класс `PageView `

Данный класс является представителем и небходим для оброботки `DOM-элемена`. Позволяет работать со страницей, а именно устанавливает слушатели событий на ключевые кнопки страницы и имеет возможность блокировать прокрутку страницы. Наследует класс `Component`.

#### Поля

- `uiWrapper`: Предназначен для работы с оберткой страницы.

- `uiCounter`: Предназначен для отображения кол-ва товаров.

- `uiCatalog`: Предназначен для работы с оберткой каталога товаров.

- `uiBasketButton`: Предназначен для установки слушателя событий и генерации события открытия модального окна корзины товаров.

#### Конструктор

В конструкторе получает класс `events` для работы и установки событий на странице.

#### Методы

- `setCounter`: Устанавливает значение в поле `uiCounter`.

- `lockPage`: В качестве параметра получает `value: boolean`, в случае `true` добавляет к элементу `uiWrapper` класс `page__wrapper_locked`, а если `false` то удаляет этот класс.

### Класс `ModalView`

Данный класс является представителем и небходим для оброботки `DOM-элемента` который потом возваращает в методе `render`. Позволяет работать со модальными окнами, а именно принимает `child` то есть контент модального окна, монтирует его и возвращает. Наследует класс `Component`.

#### Поля

- `uiCloseButton`: Предназначен для установки слушателя событий и которое сообщает о закрытии модального окна.

- `childContainer`: Предназначен для отображения содержимого модального окна.

- `child`: Содержит `HTMLElement` который монтируется в элемент `childContainer`.

#### Конструктор

В конструкторе получает класс `events` для работы и установки событий закрытия модального окна. Так же получает параметр `container` для работы с контейнером модального окна.

#### Методы

- `open`: Добавляет к контейнеру класс `modal_active`.

- `close`: Удаляет у контейнера класс `modal_active`, а так же удаляет содержимое модального окна.

- `render`: В качестве параметра принимает `child` который монтирует в элемент `childContainer` и сохраняет в поле `child`. Так же данный метод использует метод `open` и возвращает готовый контейнер.

### Класс `Form`

Данный класс небходим для оброботки `DOM-элемента`. Позволяет работать с формами, а именно устанавливает слушатели событий на ключевые кнопки, валидирует информацию полей, блокирует или разблокирует кнопку подтверждения формы. Наследует класс `Component`.

#### Поля

- `submit`: Предназначен для хранении разметки кнопки подтверждения формы.

- `errors`: Предназначн для вывода ошибок.

#### Конструктор

В конструкторе получает класс `events` для работы и установки событий подтверждения формы. Так же получает параметр `container` для работы с контейнером формы.

#### Методы

- `set valid`: В качестве параметра получает `value` и передает это булевое значение в атрибут `disabled` у кнопки подтверждения.

- `set errors`: В качесестве парметров получает `value` и устанавливет значение `textContent` у поля с ошибками равное строке `value`.

- `validate`: В качестве параметра получает `value`, проводит валидацию это значения и в случае если ошибок нет возваращает `false` иначе `true`.

- `change`: В качестве параметра принимает `value`, после чего вызывает метод `validate` передевая в качестве валидируемого значения `value`, в случае если ошибко нет использует метод `set valid` передавая `false` иначе передает `true`.

### Класс `AuctionApi`

Данный класс небходим для работы c запросами к `api`. Он имеет уже готовые запросы с нужными `uri`. Наследует класс `Api`.

#### Поля

- `cdn`: Содержит в себе базовую ссылку `api` где лежат картинки.

#### Конструктор

В конструкторе получает `cdn`, `baseUrl` и `options`. `cdn` является базовой ссылкой к `api` где лежат картинки. `baseUrl` является базовой ссылкой к `api`. `options` является объектом с насройками запроса.

#### Методы

- `getProductList`: Делает запрос `get` который наследует от базового класса `api`. В качестве `uri` выступает ссылка `/product`. После получения ответа у каждого `product` к свойсву `image` которое хранит в себе ссылку на картинку добавляет ссылку `cdn`.

- `sendOrder`: Получает в качестве параметра `order` который является объектом с данными о заказе и отправляет их использую метод `post` который наследует от базвого класса `api`. В качестве `uri` передается ссылка `/order`.

## Ключевые типы данных

Общий интерфейс для классов представления:

```
export interface IView {
	render: (data: object) => HTMLElement;
}
```

Общий тип для объекта товара:

```
export type TProduct = {
	id: string;
	category: string;
	title: string;
	image: string;
	price: number;
	description: string;
};
```

Ключевой тип который объясняет чего мы ждем от `Api` при запросе каталога:

```
type TResponseProductList = {
	items: TProduct[];
	total: number;
};
```
