# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Об архитектуре

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях. Дана архитектура носит название MVP.

## Базовый код

### Класс `Model<T>`

Данный класс является базовым и необходим для наследования и использования общих методов, так же он поможет отличить модель от простых объектов с данными.

#### Поля

Не имеет полей.

#### Конструктор

В конструкторе получает класс `events` данный класс нужен для метода `emitChanges`, а так же объект `data` данные которого попытается подставить в соответствующее поля.

#### Методы

`emitChanges`: В качестве параметров получает `event` который содержит название события и `payload` это объект которой нужно передать в событии.

### Класс `Component<T>`

Данный класс является базовым и необходим для наследования и использования общих методов для работы с `DOM-элементами`. Он поможет классам представителям использовать общий функционал.

#### Поля

Не имеет полей.

#### Конструктор

В конструкторе получает параметр `container`, с помощью методов ниже модифицирует этот `container`.

#### Методы

- `toggleClass`: Принимает в качестве параметров `element`, `className`, `force`. После получения параметров у данного элемента переключается класс с помощью `toggle`, в качестве названия класса служит `className`. `force` служит для точного сообщения о том нужно ли удалить класс или добавить.

- `setText`: Принимает в качестве параметров `element` и `value`. После получения параметров у данного элемента устанавливается `textContent` равное значению `value`.

- `setDisabled`: Получает в качестве параметров `element` и `state`. После получения параметров у данного элемента в зависимости от булевого значения `state` добавляется или удаляется атрибут `disabled`.

- `setHidden`: В качестве параметра принимает `element` после чего у этого `element` устанавливает стиль `display: none`.

- `setVisible`: В качестве параметра принимает `element` после чего у этого `element` удаляет стиль `display`.

- `setImage`: Принимает в качестве параметров `element`, `src` и `alt`. После получения параметров у данного `element` устанавливается атрибут `src` равное значению `src` полученного в параметрах. Так же устанавливается атрибут `alt`.

- `render`: Принимае в качестве параметров `data: Partial<T>` и сопоставляет данные объекта в соответствующии поля. Возвращает `container`.

### Класс `Api`

Данный класс является базовым и необходим для наследования и использования общих методов для работы с `api`.

#### Поля

- `baseUrl`: Содержит в себе базовую ссылку к `api`.

- `options`: Содержит в себе объект с настройками запроса.

#### Конструктор

В конструкторе получает параметры `baseUrl` который является базовой ссылкой `api` и `options` для установки настроек запроса.

#### Методы

- `handleResponse`: Получает в параметрах `response` в случае если статус `response` является `ok` возвращает `json()` этого `response`, иначе возвращает ошибку.

- `get`: Получает в параметрах `uri` и делает `get` запрос в качестве `url` использутеся комбинация из `baseUrl` и `uri`.

- `post`: Получает в параметрах `uri`, `data` и `method`. Делает `post` запрос в качестве `url` используется комбинация из `baseUrl` и `uri`. Так же есть возможность передать в настройках метод запроса из параметров, по дефолту будет `post`.

### Класс `EventEmitter`

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы `on` , `off` , `emit` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод `trigger` , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса `EventEmitter` .

## Компоненты модели данных (бизнес-логика)

### Класс `CatalogModel`

Данный класс является моделью и необходим для работы с данными каталога продуктов. Наследует класс `Model`.

#### Поля

- `items`: Содержит коллекцию объектов продукта:

```
export type TProduct = {
    id: string;
    category: string;
    name: string;
    image: string;
    price: number;
    description: string;
};
```

#### Конструктор

В конструкторе получает класс `events`, данный класс нужен для вызова события `init` который сообщает о том, что состояние коллекции класса `CatalogModel` было изменено. Так же получает `data` который передает через `super` в класс `Model`.

#### Методы

- `setItems`: Принимает в качестве параметра массив продуктов, проходит по массиву и добавляет продукты в поле `items`. В конце метод вызывает оповещение об изменении состояния.

- `getItem`: Принимает в качестве параметра `id` продукта и в случае успешного поиска в поле `items` возвращает продукт.

### Класс `BusketModel`

Данный класс является моделью и необходим для работы с данными корзины продуктов. Наследует класс `Model`. Он может приведёнными ниже методами работать с коллекцией продуктов, удалять, добавлять, отчищать, отдавать `id` продуктов, отдавать общую стоимость и прибавлять её.

#### Поля

- `items`: Содержит коллекцию ключа и значения, в роле ключа выступает `id` продукта, а в роли значения кол-во продукта добавленного в корзину.

- `totalPrice`: Содержит общую сумму товаров корзины.

#### Конструктор

В конструкторе получает класс `events`, данный класс нужен для метода `change` который сообщает о том, что состояние коллекции класса `BusketModel` было изменено. Так же получает `data` который передает через `super` в класс `Model`.

#### Методы

- `addItem`: Принимает в качестве параметра `id` и добавляет новую запись в коллекцию с `id` продукта и начальным кол-вом `0` в случае если продукт с таким `id` уже добавлен то прибавляет кол-во продукта на `1`.

- `removeItem`: Принимает в качестве параметра `id` продукта которое нужно удалить из коллекции, в случае успешного поиска уменьшает кол-во продукта на `1`, если кол-во становится равно `0` то удаляет элемент из коллекции.

- `clearTotalPrice`: Приравнивает поле `totalPrice` к 0. Необходим для отчистки общей стоимости товаров в корзине.

- `clear`: Отчищает поле `items` и вызывает методы `change` и `clearTotalPrice`.

- `incrementTotalPrice`: Принимает в качестве параметра общую стоимость товара и прибавляет её к полю `totalPrice`.

- `getTotalPrice`: Возвращает поле `totalPrice`.

- `inBasket`: Принимает в качестве параметра `id` товара и проверяет есть ли он в корзине если находит то возвращает `ture` иначе `false`.

- `getIds`: Возвращает массив состоящий из `id` товаров которые были в корзине, в случае если кол-во товара больше 1 то он копирует `id` товара столько раз сколько раз он был добавлен в корзину.

- `change`: Регистрирует событие изменения с помощью `events`, данное событие влечет за собой сборку представлений item-ов карточки корзины и рендера корзины.

### Класс `UserDataModel`

Данный класс является моделью и необходим для работы с данными пользователя. Наследует класс `Model`. Он постепенно собирает данные (реализуя паттерн `build`), а потом может их отдать одним объектом.

#### Поля

- `address`: Содержит в себе адрес пользователя.

- `email`: Содержит в себе почту пользователя.

- `paymentMethod`: Содержит в себе метод оплаты который выбрал пользователь.

- `phoneNumber`: Содержит в себе номер телефона пользователя.

#### Конструктор

В конструкторе получает `data` который передает через `super` в класс `Model`

#### Методы

- `setPayment`: Принимает в качестве параметра метод оплаты и устанавливает это значение в поле `paymentMethod`. Возвращает контекст `this`.

- `setAddress`: Принимает в качестве параметра адрес пользователя и устанавливает это значение в поле `address`. Возвращает контекст `this`.

- `setEmail`: Принимает в качестве параметра почту пользователя и устанавливает это значение в поле `email`. Возвращает контекст `this`.

- `setPhoneNumber`: Принимает в качестве параметра номер телефона пользователя и устанавливает это значение в поле `phoneNumber`. Возвращает контекст `this`.

- `getUserData`: Возвращает объект с данными пользователя:

```
return {
            address: this._address,
            email: this._email,
            paymentMethod: this._paymentMethod,
            phoneNumber: this._phoneNumber,
        };
```

## Компоненты представления

### Класс `BasketItemView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать с пунктами продуктов корзины, а именно устанавливает значения в нужные поля `ui` и устанавливает обработчики событий. Наследует класс `Component`.

#### Поля

- `uiTotalPrice`: Предназначен для отображения общей стоимости товара.

- `uiTotalCount`: Предназначен для отображения кол-во товара в корзине.

- `uiTitle`: Предназначен для отображения названия товара.

- `uiRemoveButton`: Предназначен для удаления товара из корзины.

- `id`: Содержит в себе `id` последнего товара который был собран через данный класс, необходим для кеширования контейнера который возвращается в методе `render`.

#### Конструктор

В конструкторе получает класс `events` для оповещения удаления товара из корзины и `container` для операций с темплейтом карточки товара в корзине.

#### Методы

- `set product`: В качестве параметра получает товар, устанавливает его название в соответствующее поле.

- `set totalCount`: В качестве параметра получает кол-во товара и устанавливает это значение в соответствующее поле.

- `set totalPrice`: В качестве параметра получает общую стоимость корзины и устанавливает это значение в соответствующее поле.

- `render`: В качестве параметров принимает:

```
data: {
        product: TProduct;
        totalCount: number;
        totalPrice: number;
    }
```

В случае если `id` продукта совпадает с полем `id` то просто возвращает `container`, иначе производит манипуляции с `ui` полями, а именно подставляет значения полученные в параметрах в содержимое `ui` компонентов.

### Класс `BasketView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Наследует класс `Component`.

#### Поля

- `uiTotalPrice`: Предназначен для отображения общей стоимости товаров в корзине.

- `uiOrderButton`: Предназначен для перемещения к модальному окну оформления заказа.

- `uiChildContainer`: Предназначен для монтирования собранного списка `HTMLElement`-ов полученных с помощью класса `BasketItemView`.

#### Конструктор

В конструкторе получает класс `events` для оповещения перехода к оформлению заказа и `container` для операций с темплейтом корзины товаров.

#### Методы

- `set items`: В качестве параметра получает массив `HTMLElement` которые монтирует в контейнер.

- `set totalPrice`: В качестве параметра получает общую стоимость которую потом монтирует в соответствующее поле.

### Класс `CatalogItemView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать с пунктами продуктов каталога, а именно устанавливает значения в нужные поля `ui` и устанавливает обработчики событий. Наследует класс `Component`.

#### Поля

- `uiPrice`: Предназначен для отображения стоимости товаров.

- `uiName`: Предназначен для отображения названия товара.

- `uiImage`: Предназначен для работы с изображением карточка товара.

- `uiCategory`: Предназначен для отображения категории товара.

- `dataProduct`: Предназначен для хранения данных о товаре и передаче их в событие, которое инициализируется при нажатии на саму карточку.

#### Конструктор

В конструкторе получает класс `events` для оповещения перехода к превью товара и `container` для операций с темплейтом карточки каталога. На сам контейнер так как он является карточкой, а соответственно кнопкой навешивается слушатель событий, который генерирует ивент открытия превью карточка при клике и предаёт данные карточки в этот ивент.

#### Методы

- `set title`: В качестве параметра получает название значение которого подставляет в соответствующее поле.

- `set category`: В качестве параметра получает название категории значение которого подставляет в соответствующее поле.

- `set image`: В качестве параметра получает ссылку на картинку значение которого подставляет в соответствующее поле.

- `set price`: В качестве параметра получает название значение которого подставляет в соответствующее поле. В случае если цена равна `null` то в поле с ценой записывается строка `бесценно`.

- `render`: Принимает в качестве параметра `data: TProduct`, устанавливает данные о продукте в поля `ui`.

### Класс `CatalogView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать с каталогом, а именно добавлять заранее созданный массив `HTML` элементов, которые получает в методе `render` в `container`. Наследует класс `Component`.

#### Поля

Не имеет полей.

#### Конструктор

В конструкторе получает `container` для операций с контейнером каталога карточек.

#### Методы

`set items`: В качестве параметров получает массив `HTMLButtonElement` который потом монтирует в контейнер.

### Класс `ProductView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать с модальным окном товара, а именно устанавливает значения в нужные поля `ui` и устанавливает обработчики событий. Наследует класс `Component`.

#### Поля

- `uiCategory`: Предназначен для отображения категории товара.

- `uiDescription`: Предназначен для отображения описания товара.

- `uiImage`: Предназначен для работы с изображением карточки товара.

- `uiName`: Предназначен для отображения названия товара.

- `uiPrice`: Предназначен для отображения стоимости товара.

- `uiAddToBasketButton`: Предназначен для установки слушателя на кнопку добавления товара в корзину

- `id`: Содержит `id` товара.

#### Конструктор

В конструкторе получает класс `events` для оповещения добавления товара в корзину и `container` для операций с темплейтом превью карточки.

#### Методы

- `set product`: В качестве параметра получает товар, устанавливает инофрмацию о товаре в нужные `ui` элементы, в случае если цена продукта равна `null` то в поле с ценой записывается строка `бесценно`.

- `set inBasket`: Получает булевое значение в случае если это `true` то отключае кнопку добавить в корзину и меняет её текст на `уже в корзине`.

- `render`: Принимает в качестве параметров `product: TProduct, inBasket: boolean `. Так же кеширует `id` товара и в случае, если прошлый товар имел такой `id`, то возвращает `container`.

### Класс `OrderFormView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать с формой заказа `order`, а именно валидирует информацию, устанавливает необходимые слушатели и отдает готовую форму. Наследует класс `Form`.

#### Поля

- `uiOrderButton`: Предназначен для навешивания слушателя клика, который будет вызывать события подтверждения что форма заполнена, закрытия модального окна и открытия модального окна с формой контактов.

- `uiPaymentButtons`: Предназначен для навешивания слушателей, которые будут менять выбранный метод оплаты, который сохраняется в поле `paymentMethod`.

- `uiFormInput`: Предназначен для навешивания слушателя, который будет вызывать валидацию поля `address` и заполнять это поле вводимыми данными.

- `address`: Содержит в себе данные которые ввел пользователь в поле `uiFormInput`.

- `paymentMethod`: Содержит в себе данные выбранного пользователем метода оплаты.

#### Конструктор

В конструкторе получает класс `events` для оповещений что форма успешно заполнена, необходимо закрыть модальное окно и открыть модальное окно с контактами. Так же получает параметр `container` для операций с темплейтом формы оформления заказа.

#### Методы

- `validateAddress`: Валидирует поле `address`, в случае если поле пустое возвращает `false`.

- `validatePaymentMethod`: Валидирует поле `paymentMethod`, в случае если поле пустое возвращает `false`.

- `changed`: Данный метод вызывается при каждом изменении вводе текста в какое либо поле в форме, вызывает методы валидации каждого поля в случае успеха разблокирует кнопку подтверждения формы и заполняет поле `dataSubmit` в родительском классе `Form`.

- `render`: Возвращает `container`.

### Класс `ContactsFormView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать с формой контактов `contacts`, а именно валидирует информацию, устанавливает необходимые слушатели и отдает готовую форму. Наследует класс `Form`.

#### Поля

- `uiContactsButton`: Предназначен для навешивания слушателя клика, который будет вызывать события подтверждения что форма заполнена, закрытия модального окна и открытия модального окна с сообщением об успешном заказе.

- `uiEmailInput`: Предназначен для навешивания слушателя, который будет вызывать валидацию поля `email` и заполнять это поле вводимыми данными.

- `uiPhoneNumberInput`: Предназначен для навешивания слушателя, который будет вызывать валидацию поля `phoneNumber` и заполнять это поле вводимыми данными.

- `email`: Содержит в себе данные которые ввел пользователь в поле `uiEmailInput`.

- `phoneNumber`: Содержит в себе данные которые ввел пользователь в поле `uiPhoneNumberInput`.

- `errorMessage`: Содержит в себе текст ошибки.

#### Конструктор

В конструкторе получает класс `events` для оповещений что форма успешно заполнена, необходимо закрыть модальное окно и открыть модальное окно с сообщением об успешном заказе. Ивент об открытии окно, которое сообщает об успешном заказе отправляет данные с помощью `api`. Так же получает параметр `container` для операций с темплейтом формы контактов пользователя.

#### Методы

- `validateEmail`: Валидирует поле `email`, в случае если валидация по regex не проходит или поле пустое отправляет соотвествующий текст в поле `errorMessage`

- `validatePhoneNumber`: Валидирует поле `phoneNumber`, в случае если валидация по regex не проходит или поле пустое отправляет соответствующий текст в поле `errorMessage`.

- `changed`: Данный метод вызывается при каждом изменении вводе текста в какое-либо поле в форме, вызывает методы валидации каждого поля в случае успеха разблокирует кнопку подтверждения формы и заполняет поле `dataSubmit` в родительском классе `Form`.

- `render`: Возвращает `container`.

### Класс `SuccessView`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать модальным окном оповещения об успешном заказе, а именно устанавливает сумму заказа в соответствующее поле и добавляет слушатель события на кнопку `за новыми покупакми`. Наследует класс `Component`.

#### Поля

- `uiSuccessButton`: Предназначен для навешивания слушателя событий клика которое создает событие закрытия модального окна.

- `uiSuccessDescription`: Предназначен для отображения суммы заказа.

#### Конструктор

В конструкторе получает класс `events` для оповещения о закрытии модального окна. Так же получает параметр `container` для операций с темплейтом модального окна с сообщением об успешном заказе.

#### Методы

`set totalPrice`: В качестве параметров получает общую стоимость корзины, затем устанавливает это число в соответствующее поле.

### Класс `PageView `

Данный класс является представителем и необходим для обработки `DOM-элемена`. Позволяет работать со страницей, а именно устанавливает слушатели событий на ключевые кнопки страницы и имеет возможность блокировать прокрутку страницы. Наследует класс `Component`.

#### Поля

- `uiWrapper`: Предназначен для работы с оберткой страницы.

- `uiCounter`: Предназначен для отображения кол-ва товаров.

- `uiCatalog`: Предназначен для работы с оберткой каталога товаров.

- `uiBasketButton`: Предназначен для установки слушателя событий и генерации события открытия модального окна корзины товаров.

#### Конструктор

В конструкторе получает класс `events` для работы и установки событий на странице. Так же получает `container` и передает его через `super` в класс `Component`.

#### Методы

- `setCounter`: Устанавливает значение в поле `uiCounter`.

- `lockPage`: В качестве параметра получает `value: boolean`, в случае `true` добавляет к элементу `uiWrapper` класс `page__wrapper_locked`, а если `false` то удаляет этот класс.

### Класс `Modal`

Данный класс является представителем и необходим для обработки `DOM-элемента` который потом возвращает в методе `render`. Позволяет работать со модальными окнами, а именно принимает `child` то есть контент модального окна, монтирует его и возвращает. Наследует класс `Component`.

#### Поля

- `closeButton`: Предназначен для установки слушателя событий и которое сообщает о закрытии модального окна.

- `content`: Предназначен для отображения содержимого модального окна.

#### Конструктор

В конструкторе получает класс `events` для работы и установки событий закрытия модального окна. Так же получает параметр `container` для работы с контейнером модального окна.

#### Методы

- `open`: Добавляет к контейнеру класс `modal_active`. И сообщает о том что модальное окно открыто.

- `close`: Удаляет у контейнера класс `modal_active`, а так же удаляет содержимое модального окна. Сообщает о закрытии модального окна.

- `render`: В качестве параметра принимает `content` который монтирует в элемент `content`. Так же данный метод использует метод `open` и возвращает готовый контейнер.

### Класс `Form`

Данный класс необходим для обработки `DOM-элемента`. Позволяет работать с формами, а именно устанавливает слушатели событий на ключевые кнопки, валидирует информацию полей, блокирует или разблокирует кнопку подтверждения формы. Наследует класс `Component`.

#### Поля

- `submit`: Предназначен для хранения разметки кнопки подтверждения формы.

- `errors`: Предназначн для вывода ошибок.

- `dataSubmit` Содержит в себе объект данных, которые будут отправлены при подтверждении формы.

#### Конструктор

В конструкторе получает класс `events` для работы и установки событий подтверждения формы. Так же получает параметр `container` для работы с контейнером формы.

#### Методы

- `set valid`: В качестве параметра получает `value` и передает это булевое значение в атрибут `disabled` у кнопки подтверждения.

- `set errors`: В качестве параметров получает `value` и устанавливает значение `textContent` у поля с ошибками равное строке `value`.

- `set dataSubmit`: В качестве параметров получает `value` и устанавливает значение поля `dataSubmit` роавное `value`.

- `validate`: В качестве параметра получает `value`, проводит базовую валидацию на предмет пустого поля и в случае если ошибок нет возвращает `true` иначе `false`.

### Класс `AuctionApi`

Данный класс необходим для работы c запросами к `api`. Он имеет уже готовые запросы с нужными `uri`. Наследует класс `Api`.

#### Поля

- `cdn`: Содержит в себе базовую ссылку `api` где лежат картинки.

#### Конструктор

В конструкторе получает `cdn`, `baseUrl` и `options`. `cdn` является базовой ссылкой к `api` где лежат картинки. `baseUrl` является базовой ссылкой к `api`. `options` является объектом с настройками запроса.

#### Методы

- `getProductList`: Делает запрос `get` который наследует от базового класса `api`. В качестве `uri` выступает ссылка `/product`. После получения ответа у каждого `product` к свойсву `image` которое хранит в себе ссылку на картинку добавляет ссылку `cdn`.

- `sendOrder`: Получает в качестве параметра `order` который является объектом с данными о заказе и отправляет их использую метод `post` который наследует от базвого класса `api`. В качестве `uri` передается ссылка `/order`.

## Ключевые типы данных

Общий тип для объекта товара:

```
export type TProduct = {
    id: string;
    category: string;
    title: string;
    image: string;
    price: number;
    description: string;
};
```

Ключевой тип, который объясняет, чего мы ждем от `Api` при запросе каталога:

```
type TResponseProductList = {
    items: TProduct[];
    total: number;
};
```
